
<extension implements="::fwServices::registry::AppConfig">
    <id>SDBVRRender</id>
    <parameters>
        <param name="GENERIC_UID" />
        <param name="SERIESDB" />
        <param name="WID_PARENT" />
        <param name="DYNAMICVIEW_CHANNEL" default="channel" />
        <param name="PROGRESS_CHANNEL" default="progressChannel" />
        <param name="ICON_PATH" />
    </parameters>
    <config>

        <object type="::fwData::Composite">

            <service uid="${GENERIC_UID}_mainview" type="::gui::view::IView" impl="::gui::view::SDefaultView" autoConnect="yes">
                <gui>
                    <layout type="::fwGui::CardinalLayoutManager">
                        <view caption="Information" align="center" minWidth="200" />
                        <view caption="Preview" align="bottom" minHeight="200" />
                        <view caption="Activity creator" align="bottom" minHeight="400" visible="no" />
                    </layout>
                    <toolBar />
                </gui>
                <registry>
                    <parent wid="${WID_PARENT}" />
                    <toolBar sid="${GENERIC_UID}_toolBar" start="yes" />
                    <view sid="${GENERIC_UID}_selector" start="yes" />
                    <view wid="${GENERIC_UID}_preview" />
                    <view sid="${GENERIC_UID}_activityCreator" start="yes" />
                </registry>
            </service>



            <service uid="${GENERIC_UID}_toolBar" type="::fwGui::IToolBarSrv" impl="::gui::aspect::SDefaultToolBar">
                <gui>
                    <layout>
                        <menuItem name="Import" icon="Bundles/media_0-1/icons/Import.svg" />
                        <menuItem name="Export" icon="Bundles/media_0-1/icons/Export.svg" />
                        <menuItem name="Launch activity" icon="Bundles/media_0-1/icons/Launch_activity.svg" />
                        <menuItem name="Create a new activity" icon="Bundles/media_0-1/icons/CreateActivity.svg" />
                        <separator />
                        <menuItem name="2D visualization" icon="Bundles/media_0-1/icons/icon-2D.png" />
                        <menuItem name="3D visualization" icon="Bundles/media_0-1/icons/icon-3D.png" />
                        <menuItem name="Volume rendering" icon="Bundles/media_0-1/icons/icon-VR.png" />
                    </layout>
                </gui>
                <registry>
                    <menuItem sid="${GENERIC_UID}_action_import" start="yes" />
                    <menuItem sid="${GENERIC_UID}_action_exportSeries" start="yes" />
                    <menuItem sid="${GENERIC_UID}_action_newActivity" start="yes" />
                    <menuItem sid="${GENERIC_UID}_action_createActivity" start="yes" />

                    <menuItem sid="${GENERIC_UID}_action_2DVisualization" start="yes" />
                    <menuItem sid="${GENERIC_UID}_action_3DVisualization" start="yes" />
                    <menuItem sid="${GENERIC_UID}_action_volumeRendering" start="yes" />
                </registry>
            </service>


            <item key="seriesDB">
                <object uid="${SERIESDB}" type="::fwMedData::SeriesDB" src="ref">
                    <service uid="${GENERIC_UID}_action_import" type="::fwGui::IActionSrv" impl="::uiIO::action::SSeriesDBMerger">
                        <IOSelectorSrvConfig name="SDBReaderIOSelectorConfig" />
                    </service>
                    <service uid="${GENERIC_UID}_selector" impl="::uiMedData::editor::SSelector" autoConnect="yes">
                        <selectionId>${GENERIC_UID}_selections</selectionId>
                    </service>

                    <!-- Editor to create/update an activity. -->
                    <service uid="${GENERIC_UID}_activityCreator" impl="::uiMedData::editor::SActivityWizard">
                        <ioSelectorConfig>FullSDBReaderIOSelectorConfig</ioSelectorConfig>
                        <icons>
                            <icon type="::fwMedData::ImageSeries" icon="Bundles/media_0-1/icons/ImageSeries.svg" />
                            <icon type="::fwMedData::ModelSeries" icon="Bundles/media_0-1/icons/ModelSeries.svg" />
                        </icons>
                    </service>

                </object>
            </item>

            <item key="selections">
                <object uid="${GENERIC_UID}_selections" type="::fwData::Vector">
                    <service uid="${GENERIC_UID}_seriesViewer" type="::fwServices::IController" impl="::uiMedData::SSeriesViewer" autoConnect="yes">
                        <parentView>${GENERIC_UID}_preview</parentView>
                        <configs>
                            <config id="2DSimpleConfig" type="::fwMedData::ImageSeries">
                                <extract path="@image" pattern="imageID" />
                            </config>
                            <config id="3DSimpleConfig" type="::fwMedData::ModelSeries" />
                            <config id="ActivityCreatorConfig" type="::fwMedData::ActivitySeries">
                                <parameter replace="SERIESDB" by="${SERIESDB}" />
                            </config>
                        </configs>
                    </service>
                    <service uid="${GENERIC_UID}_action_newActivity" type="::fwGui::IActionSrv" impl="::activities::action::SActivityLauncher" autoConnect="yes">
                        <config>
                            <parameters>
                                <parameter replace="SERIESDB" by="${SERIESDB}" />
                                <parameter replace="ICON_PATH" by="${ICON_PATH}" />
                            </parameters>
                            <filter>
                                <mode>exclude</mode>
                                <id>ImageSeriesExport</id>
                                <id>ModelSeriesExport</id>
                            </filter>
                        </config>
                    </service>

                    <service uid="${GENERIC_UID}_action_2DVisualization" type="::fwGui::IActionSrv" impl="::activities::action::SActivityLauncher" autoConnect="yes">
                        <config>
                            <parameters>
                                <parameter replace="SERIESDB" by="${SERIESDB}" />
                                <parameter replace="ICON_PATH" by="${ICON_PATH}" />
                            </parameters>
                            <filter>
                                <mode>include</mode>
                                <id>2DVisualization</id>
                            </filter>
                        </config>
                    </service>

                    <service uid="${GENERIC_UID}_action_3DVisualization" type="::fwGui::IActionSrv" impl="::activities::action::SActivityLauncher" autoConnect="yes">
                        <config>
                            <parameters>
                                <parameter replace="SERIESDB" by="${SERIESDB}" />
                                <parameter replace="ICON_PATH" by="${ICON_PATH}" />
                            </parameters>
                            <filter>
                                <mode>include</mode>
                                <id>3DVisualization</id>
                            </filter>
                        </config>
                    </service>

                    <service uid="${GENERIC_UID}_action_volumeRendering" type="::fwGui::IActionSrv" impl="::activities::action::SActivityLauncher" autoConnect="yes">
                        <config>
                            <parameters>
                                <parameter replace="SERIESDB" by="${SERIESDB}" />
                                <parameter replace="ICON_PATH" by="${ICON_PATH}" />
                            </parameters>
                            <filter>
                                <mode>include</mode>
                                <id>VolumeRendering</id>
                            </filter>
                        </config>
                    </service>

                    <service uid="${GENERIC_UID}_action_createActivity" type="::fwGui::IActionSrv" impl="::activities::action::SCreateActivity">
                        <filter>
                            <mode>exclude</mode>
                            <id>ImageSeriesExport</id>
                            <id>ModelSeriesExport</id>
                        </filter>
                    </service>

                    <service uid="${GENERIC_UID}_action_exportSeries" impl="::activities::action::SActivityLauncher" autoConnect="yes">
                        <config>
                            <mode>immediate</mode>
                            <parameters>
                            </parameters>
                            <filter>
                                <mode>include</mode>
                                <id>ImageSeriesExport</id>
                                <id>ModelSeriesExport</id>
                            </filter>
                        </config>
                    </service>

                </object>
            </item>


            <connect><!-- Launch a series when it is double clicked. -->
                <signal>${GENERIC_UID}_selector/seriesDoubleClicked</signal>
                <slot>${GENERIC_UID}_action_newActivity/launchSeries</slot>
            </connect>
            
            <connect><!-- Hide the creator editor when the activity creation is canceled. -->
                <signal>${GENERIC_UID}_activityCreator/canceled</signal>
                <slot>${GENERIC_UID}_activityCreator/hide</slot>
            </connect>

            <!-- Proxy to hide the creator editor when the activity is created/updated. -->
            <proxy channel="hide_activity_creator_channel">
                <signal>${GENERIC_UID}_activityCreator/activityCreated</signal>
                <signal>${GENERIC_UID}_activityCreator/activityUpdated</signal>
                <slot>${GENERIC_UID}_activityCreator/hide</slot>
            </proxy>

            <!-- Proxy to show the creator editor when the activity should be created. -->
            <proxy channel="create_activity_channel">
                <signal>${GENERIC_UID}_action_createActivity/activityIDSelected</signal>
                <slot>${GENERIC_UID}_activityCreator/show</slot>
                <slot>${GENERIC_UID}_activityCreator/createActivity</slot>
            </proxy>
            
            <!-- Proxy to show the creator editor when the activity should be updated. -->
            <proxy channel="update_activity_channel">
                <signal>${GENERIC_UID}_action_createActivity/activitySelected</signal>
                <slot>${GENERIC_UID}_activityCreator/show</slot>
                <slot>${GENERIC_UID}_activityCreator/updateActivity</slot>
            </proxy>

            <!-- Proxy to display progress bar -->
            <proxy channel="${PROGRESS_CHANNEL}">
                <signal>${GENERIC_UID}_action_import/jobCreated</signal>
            </proxy>

            <!-- Proxy to launch the activity using old SActivityLauncher service. -->
            <proxy channel="${DYNAMICVIEW_CHANNEL}">
                <signal>${GENERIC_UID}_action_newActivity/activityLaunched</signal>
                <signal>${GENERIC_UID}_action_2DVisualization/activityLaunched</signal>
                <signal>${GENERIC_UID}_action_3DVisualization/activityLaunched</signal>
                <signal>${GENERIC_UID}_action_volumeRendering/activityLaunched</signal>
            </proxy>

            <start uid="${GENERIC_UID}_mainview" />
            <start uid="${GENERIC_UID}_seriesViewer" />

        </object>

    </config>
</extension>
